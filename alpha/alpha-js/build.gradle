
buildscript {
    ext.jsTargetDir = file("${buildDir.path}/classes/main/")

    repositories {
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath "com.moowork.gradle:gradle-node-plugin:1.2.0"
    }
}

apply plugin: 'com.moowork.node'

dependencies {
    expectedBy project(":alpha")
    compile project(":beta:beta-js")
    compile project(":gamma:gamma-js")
}

node {
    download = true
    version = '9.4.0'
    npmVersion = '5.6.0'
    nodeModulesDir = buildDir
}

/* Install the Kotlin javascript file. */
task installKotlinJs(type: NpmTask) {
  args = ['install', '--silent', 'kotlin']
}

//classes.dependsOn.remove("compileJava")
//project(":alpha:js").classes.dependsOn.remove("alpha:js:compileKotlin2Js")

//task copyKotlinJs(type: Copy) {
//    dependsOn installKotlinJs
//    from file("${buildDir.path}/node_modules/kotlin/kotlin.js")
//    from file("${buildDir.path}/node_modules/kotlin/kotlin.meta.js")
//    into file("${jsTargetDir.path}")
//}
//
//copyKotlinJs.dependsOn assemble
//build.dependsOn copyKotlinJs

build.dependsOn installKotlinJs

task run(type: NodeTask) {
    description = "Run the Javascript code using NodeJS (no browser)"
    dependsOn build
    def pth = "${jsTargetDir.path}/${project.name}.js"
    println("run $pth with node")
    script = file(pth)
}


